# Intrdução
Este documento serva para ser uma anotação mais simples e resumida referente as triggers que criamos no banco de dados.

## O que é uma trigger?
Basicamente a trigger visa automatizar e realizar ações assim que um evento é realizado, isto é: assim que um comando DML é realizado em determinada tabela ou tabelas...

### Palavras chaves para trigger:

NEW -> nova linha/registro,

OLD -> manter linha/registro antiga(o),

### Sintaxe para a criação de triggers/gatilhos

essa é uma sintaxe básica para criamos uma trigger assim que criamso a função que retorna um evento para a trigger

```sql
CREATE TRIGGER nome_trigger 
    {quando será disparada: BEFORE|AFTER|INSTEAD OF }
    {evento: INSERT | UPDATE | DELETE [OR...] } ON tabela ou view
    [FROM nome_tabela_referenciada]
    [FOR [EACH] {ROW | STATEMENT} ]
    EXECUTE PROCEDURE funcao_nome (argumentos); 
```

### Diferenças entre FOR EACH ROW E FOR EACH STATEMENT

- Os eventos podem ser executados por linha alterada (for each row ) pu por comando executado ( for each statement )

- A difença entre os dois modos é transacional:

    FOR EACH ROW: executa cada linha como uma transação

    FOR EACH STATEMENT executa cada comando como uma transação

## Simulação
Essa simulação tem como principal objetivo mostrar como vai funcionar a trigger no nosso postgresql

```sql

-- Colocando diretriz que coloca o fuso horário local no postgres

SET TIME ZONE 'America/Sao_Paulo';

-- Vamos criar a tabela auditoria, que registra as datas em que mudanças foram feitas na tabela funcionarios

CREATE TABLE funcionarios(
    idfuncionario INTEGER GENERATED ALWAYS IDENTITY PRIMARY KEY, 
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    telefone CHAR(14 NOT NULL),
    profissao VARCHAR(150) NOT NULL,
    salario REAL 
);

-- tabela que irá resceber a nossa trigger ao atualizar dados na tabela funcionário
CREATE TABLE funcionario_auditoria(
    idauditoria INTEGER GENERATED ALWAYS IDENTITY PRIMARY KEY,
    codigo_func INT NOT NULL,
    data_alteracao DATA NOT NULL
);


-- CRAINDO FUNÇÃO QUE IRÁ RETORNAR EVENTO PARA TRIGGER
CREATE OR REPLACE FUNCTION funcionario_log_func() RETURNS TRIGGER 
AS $$
    BEGIN
        -- inserindo registros na tabela
        INSERT INTO funcionario_auditoria(codigo_func,data_alteracao)
        VALUES(NEW.codigo_func, CURRENT_DATE);
      
        RETURN NEW; -- indica que nova linha será inserida
    END
$$
Language plpgsql;


-- CRAINDO A NOSSA TRIGGER DE FATO
CREATE TRIGGER log_trigger()
    AFTER INSERT OR UPDATE ON funcionarios
    FOR EACH ROW 
    EXECUTE PROCEDURE funcionario_log_func();
```