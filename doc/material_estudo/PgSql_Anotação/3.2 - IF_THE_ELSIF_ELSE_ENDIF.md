# Introdução
Este documento visa mostrar o funcionamento da estrutura de tomade de decisão com plpgsql levando em conta que você saiba a lógica de programação.

## Sintaxe:

- Os comandos condicionais são muito parecidos com os de outras linguagens procedimentais :

```sql
-- forma abreviada de fazer uma função, boa para testes!
DO $$
DECLARE
    -- declaração de variáveis
BEGIN -- corpo da nossa instrução plpgsql

    -- se(condição) faça isso
    IF (condição) THEN 
        (bloco de comando/logica_programação) 
    END IF(fim do if);

    -- se(condição) faça isso senao faça isso
    IF (condição) THEN
        (bloco de comando/logica_programação1)
    ELSE
        (bloco de comando/logica_programação2)
    END IF (fim do if);

    -- se encadiado
        IF (condição) THEN
            (bloco de comando/logica_programação1)
        ELSIF (condição) THEN
            (bloco de comando/logica_programação2)
        ELSE
            (bloco de comando/logica_programação2)
        END IF (fim do if);
END; -- fim do corpo da nossa instrução plpgsql
$$ LANGUAGE plpgsql;
```
- Os comandos sempre devem terminar com um END IF;

## Exemplos de scripts:

Primeiro exemplo:

```sql
-- vamos definir uma parâmetro de entrada explícitamente
-- Lembrando que quando não é explícitado, implicitamente é parâmetro de entrada
-- ou  seja, é DEFAULT
-- TOME CUIDADO COM A IDENTAÇÃO

CREATE TABLE OR REPLACE TABLE atualizar_email( IN INTEGER v_user_id) RETURNS VOID 
AS$$
    DECLARE -- lembrando que é opcional declarar variáveis
    BEGIN -- corpo a nossa instrução plpgsql
        IF v_user_id <> 0 THEN
            UPDATE users SET email = v_email WHERE user_id = v_user_id;
        END IF;
    END; -- fim do corpo
$$
language plpsql;
```

Segundo Exemplo:

```sql
-- CUIDADO COM A INDENTAÇÃO!
CREATE OR REPLACE FUNCTION inserir_conta(INTEGER v_count) RETURNS BOOLEAN
AS $$
    BEGIN
        IF v_count > 0 THEN
            INSERT INTO users_count (count)
                VALUES (v_count);
            RETURN 't'; -- valor true dentro do plpgsql
        ELSE 
            RETURN 'f';
        END IF;
    END;
$$ 
Language plpgsql;
```

Terceiro exemplo:

```sql

-- Criando uma função que retorna true para professores que ganham seus salários mais que a média e false se ele ganha menor que a média

-- Logo temos a seguinte condição: Se salario > media_salario return true seao return false;

-- Craindo função com parâmetro de entrada! 
CREATE OR REPLACE FUNCTION av_salario(IN idprof INTEGER) RETURNS BOOLEAN 
AS $$
    DECLARE -- Declarando variáveis locais
        media REAL;
        salario_prof REAL;
    BEGIN
        -- colocando o valor retornado do select na variável local com into
        SELECT AVG(salario) FROM professor INTO media;

        -- colocando o valor retornado do select na variável local com into
        SELECT prof.salario FROM professor AS proof 
        WHERE idprofessor = idprof INTO salario_prof;

        IF (salario_prof >= media) THEN
            RETURN TRUE;
        ELSE
            RETURN FALSE;
        END IF;
    END;
$$ 
Language plpgsql;
```