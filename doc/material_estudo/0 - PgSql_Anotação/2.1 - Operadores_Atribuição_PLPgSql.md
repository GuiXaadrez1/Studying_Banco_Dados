## Introdução Operadores de Atribuição no PL/pgSQL

No PL/pgSQL, linguagem procedural do PostgreSQL, os operadores de atribuição são fundamentais para manipular valores em variáveis, colunas ou registros dentro de blocos de código.

Eles permitem guardar, atualizar ou modificar valores existentes em variáveis, de forma semelhante ao que acontece em linguagens de programação como Python, C ou Java.

No PostgreSQL, esses operadores não se aplicam diretamente a tabelas, mas sim a variáveis declaradas dentro de funções, procedimentos, triggers ou blocos anônimos (DO).

## Tipos de Atribuição

O PL/pgSQL oferece diferentes formas de atribuir valores:

### Operador de Atribuição Simples (:=)

É o principal operador de atribuição no PL/pgSQL.

Usado para inicializar ou atualizar valores de variáveis.

Aceita qualquer expressão válida do PostgreSQL (literais, funções, cálculos, etc.).

- Sintaxe:

```sql
variavel := expressão;
```

- Exemplo:

```sql
DO $$
DECLARE
    v_nome TEXT;
    v_idade INT;
BEGIN
    v_nome := 'Maria';
    v_idade := 25;

    RAISE NOTICE 'Nome: %, Idade: %', v_nome, v_idade;
END;
$$;
```

### Atribuição a partir de SELECT (SELECT INTO)

Permite atribuir o resultado de uma consulta SQL diretamente a variáveis.

Importante quando se deseja recuperar dados de uma tabela.

- Sintaxe:

```sql
SELECT coluna
INTO variavel
FROM tabela
WHERE condição;
```

- Exemplo:

```sql
DO $$
DECLARE
    v_email TEXT;
BEGIN
    SELECT email
    INTO v_email
    FROM clientes
    WHERE id = 1;

    RAISE NOTICE 'Email do cliente 1: %', v_email;
END;
$$;
```

### Atribuição a partir de SELECT com PERFORM

Quando não há necessidade de armazenar o valor, apenas executar a query.

Não armazena em variável, apenas executa (serve como atribuição "descartada").

- Exemplo:

```sql
DO $$
BEGIN
    PERFORM * FROM clientes WHERE id = 1;
    RAISE NOTICE 'Consulta executada, mas sem atribuição.';
END;
$$;
```

### Atribuição com := usando Expressões

Além de valores fixos, o := aceita expressões aritméticas, lógicas e funções.

- Exemplo com cálculos:

```sql
DO $$
DECLARE
    v_num1 INT := 10;
    v_num2 INT := 5;
    v_resultado INT;
BEGIN
    v_resultado := v_num1 + v_num2; -- atribuição com expressão
    RAISE NOTICE 'Resultado: %', v_resultado;
END;
$$;
```

## Operadores Compostos de Atribuição

Assim como em outras linguagens, o PL/pgSQL permite atribuições compostas, que fazem uma operação e atribuem o valor diretamente.

| Operador         | Descrição                                                  | Exemplo       |
| ---------------- | ---------------------------------------------------------- | ------------- |
| `:=`             | Atribuição simples                                         | `x := 10;`    |
| `x := x + valor` | Soma e atribui (não existe `+=` nativo, mas é equivalente) | `x := x + 5;` |
| `x := x - valor` | Subtração e atribuição                                     | `x := x - 2;` |
| `x := x * valor` | Multiplicação e atribuição                                 | `x := x * 3;` |
| `x := x / valor` | Divisão e atribuição                                       | `x := x / 4;` |
| `x := x % valor` | Módulo (resto) e atribuição                                | `x := x % 2;` |

- Exemplo:

```sql
DO $$
DECLARE
    v_contador INT := 10;
BEGIN
    v_contador := v_contador + 5; -- equivalente ao += em outras linguagens
    v_contador := v_contador - 3;
    v_contador := v_contador * 2;

    RAISE NOTICE 'Valor final: %', v_contador;
END;
$$;
```

## Atribuição em Registros e Linhas (ROW TYPE)

Podemos atribuir valores a linhas inteiras de tabelas ou registros compostos.

- Exemplo:

```sql
DO $$
DECLARE
    v_cliente RECORD;
BEGIN
    SELECT id, nome, email
    INTO v_cliente
    FROM clientes
    WHERE id = 1;

    -- preste atenção mo ponto puxando os atributos 
    -- Basicamente estamos pegando cada linha retornada pelo nosso select
    -- atribuindo a uma variável chamada v_cliente
    -- e puxando os atributos de cada linha pela variável usando o ponto final
    RAISE NOTICE 'Cliente: % (% - %)', v_cliente.id, v_cliente.nome, v_cliente.email;
END;
$$;
```

## Diferença entre = e := no PL/pgSQL

No SQL (queries), o operador = é usado para comparação:

```sql
SELECT * FROM clientes WHERE id = 1;
```

No PL/pgSQL (procedural), o operador := é usado para atribuição:

```sql
v_id := 1;
```

⚠️ Importante: tentar usar = para atribuição em PL/pgSQL gera erro.

## Resumo Geral

- := → atribuição direta de valores/expressões a variáveis.

- SELECT INTO → atribuição de resultados de queries a variáveis.

- PERFORM → executa query sem atribuição.

- Atribuições compostas → x := x + valor, x := x - valor, etc.

- Registros → podem receber atribuições de linhas completas.

- = é comparação, não atribuição, em PL/pgSQL.