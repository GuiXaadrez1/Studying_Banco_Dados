# Introdução
Este documento visa mostrar como funciona o laço de repetição while em plpgsql, estou levando em conta que você já sabe a lógica de programação.

## Sintaxe:

```sql
WHILE (condicao) LOOP
    comando1/lógica de programação;
    comando2/lógica de programação;
    comando3/lógica de programação;
    ...
END LOOP;

-- ele só vai sair do loop assim que a condição seja satisfeita
```

## EXEMPLOS PRÁTICOS:

Exemplo 1:
```sql

-- Vamos criar uma função que calcule o fatoria de um número inteiro positivo

/*
    Como funciona o fatorial
    0! = 1 
    n! = n*(n-1)

    o ponto de exclamação significa fatorial!

*/

CREATE OR REPLACE FUNCTION calc_fat(IN INTEGER n_positivo) RETURN INTEGER
AS$$
    DECLARE
        fat INTEGER := 1; -- fat vai resceber um como padrão;
        i INTEGER := 2; -- incrementador do nosso loop
    BEGIN
        WHILE (i <= n_positivo) LOOP
            fat := fat*i; -- fat resceberá o valor de fat vezes o incremento
            i := i + 1; -- isso é o mesmo que i++
        END LOOP; -- fim do loop
        RETURN fat;
    END;
$$
Language plpgsql;
```

## Criando um laço de repetição while que faz loops infinitos
Essa é uma forma para quando precisamos fazer laços de repetições infinitos e precisamos 
quebrar o laço caso uma condição dentro do bloco de tomade de repetição dentro deste laço de repetição seja atendida

### sintaxe:

```sql
LOOP
  -- Bloco de código
  IF <condição> THEN
    EXIT; -- Sai do loop
  END IF;
END LOOP;
```

Você também pode usar EXIT WHEN para o mesmo efeito:

```sql
LOOP
  -- Bloco de código
  EXIT WHEN <condição>;
END LOOP;
```

## Ponto importante: Controle de fluxo

1️⃣ LOOP cria repetição sem condição de parada.

2️⃣ EXIT ou EXIT WHEN finaliza o loop quando a condição for verdadeira.

3️⃣ Você pode também usar um rótulo para controlar loops aninhados:

```sql
<<main_loop>> -- esse é o nome do nosso rótulo
LOOP
  -- Código, colocando o nome do nosso rótuloa qui
  EXIT main_loop WHEN <condição>;
END LOOP;
```
### Exemplo prático:

```sql
DO $$
    DECLARE
        counter INTEGER := 0;
    BEGIN
        LOOP
            RAISE NOTICE 'Contador: %', counter;
            counter := counter + 1;

            IF counter >= 5 THEN
                EXIT; -- Sai quando a condição for satisfeita
            END IF;
        END LOOP;

        RAISE NOTICE 'Loop encerrado.';
    END 
$$;
```
O que faz:

Começa com counter = 0

Incrementa counter a cada iteração

Sai quando counter >= 5

###  Recomendações de boas práticas

- Evite loops infinitos sem EXIT. Se errar a lógica, o bloco pode travar ou consumir recursos desnecessariamente.

- Para processamento em lote, considere FOR ou WHILE se souber a condição de parada de antemão.

- Para controle granular ou polling (esperar algo mudar), LOOP + EXIT WHEN é o padrão.