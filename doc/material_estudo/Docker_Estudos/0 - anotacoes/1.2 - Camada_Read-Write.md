# Introdução

O Docker é uma plataforma de contêineres que permite a criação, execução e gerenciamento de aplicações em ambientes isolados, leves e portáteis. Um dos pilares fundamentais que sustentam a eficiência dos containers é seu modelo de camadas de sistema de arquivos. Este modelo, baseado em uma estrutura Union File System, permite a reutilização de imagens e a separação clara entre os dados de uma aplicação e seu ambiente de execução.

Dentro desse modelo, destaca-se a camada de leitura e escrita, chamada de Read/Write Layer (R/W Layer), que desempenha um papel crucial durante a execução dos containers.

## Anatomia do Sistema de Arquivos em Docker

Toda imagem Docker é composta por múltiplas camadas somente leitura (Read-Only Layers). Essas camadas são geradas a partir das instruções do Dockerfile (como FROM, RUN, COPY, etc). Elas são empilhadas e combinadas pelo Docker para formar o sistema de arquivos da imagem final.

Quando um container é criado a partir de uma imagem, o Docker adiciona uma nova camada no topo da pilha: a camada de leitura e escrita (R/W Layer).

Exemplo Visual:

```plaintext
[ Camada RW do Container ]    ← read-write
[ Camada da imagem: COPY ]     ← read-only
[ Camada da imagem: RUN ]      ← read-only
[ Camada base: Ubuntu ]        ← read-only
```

Essa estrutura de camadas é possível graças ao uso de sistemas de arquivos unionizados como OverlayFS (no Linux).

## O Que é a Camada de Leitura e Escrita (Read/Write Layer)

A camada de leitura e escrita é uma estrutura temporária e volátil criada no momento em que o container é iniciado. Esta camada serve para armazenar:

- Arquivos criados pelo processo em execução no container

- Modificações em arquivos existentes nas camadas inferiores

- Deleções lógicas (técnica chamada de whiteout)

- Dados gerados durante a execução do container

Essa camada é isolada e exclusiva por container, e é descartada assim que o container é removido, a menos que você use volumes ou bind mounts para persistência de dados.

## Como Funciona a Escrita em OverlayFS

O Docker geralmente usa o OverlayFS, um sistema de arquivos unionizado que permite "mesclar" múltiplos diretórios em um único ponto de montagem. Em termos práticos:

Quando um processo dentro do container tenta ler um arquivo, o Docker procura da camada superior para baixo até encontrar o arquivo.

Quando tenta escrever/modificar um arquivo, o Docker copia o arquivo da camada read-only para a camada R/W (operação chamada de Copy-on-Write), e a modificação ocorre na cópia.

Ilustração do processo:

```plaintext
1. Arquivo original está na camada read-only
2. Container tenta modificar o arquivo
3. Docker copia o arquivo para a camada R/W
4. Modificação é feita na cópia
```

Esse comportamento garante que a imagem base nunca seja alterada, o que facilita o reuso e a consistência entre ambientes.

## Persistência e Efemeridade

A camada R/W é efêmera por natureza: quando o container é removido, todo o conteúdo da R/W Layer é perdido.

### Alternativas para persistência de dados:

- Volumes (docker volume): Armazenamento gerenciado pelo Docker fora da R/W Layer.

- Bind mounts: Montagem de diretórios reais do host no container.

- tmpfs mounts: Armazenamento volátil na memória, útil para dados sensíveis ou temporários.

## Implicações Práticas

### Performance

O uso de camadas overlay pode impactar a performance de escrita. Para operações intensivas de I/O, recomenda-se 1o uso de volumes ou bind mounts.

### Isolamento

Cada container possui sua própria R/W Layer, o que garante que modificações em um container não afetam outros containers baseados na mesma imagem.

### Imutabilidade

Imagens Docker permanecem imutáveis graças ao modelo de R/W Layer. Isso permite reprodutibilidade de ambientes.

### Exemplo

```bash
# Cria um container a partir da imagem oficial do nginx
docker run -dit --name test-nginx nginx

# Acessa o container
docker exec -it test-nginx bash

# Cria um novo arquivo dentro do container
echo "Olá Docker" > /tmp/exemplo.txt
```

Neste exemplo, o arquivo exemplo.txt será armazenado na camada de leitura e escrita do container. Se o container for removido com docker rm, esse arquivo também será perdido — a menos que tenha sido salvo em um volume.

## Conclusão

A camada de leitura e escrita dos containers Docker é um componente fundamental que oferece:

- Isolamento de modificações

- Efemeridade por padrão

- Suporte a alterações sem modificar a imagem base

Porém, é importante entender suas limitações e usá-la de forma consciente. Em aplicações que requerem persistência, deve-se sempre usar volumes para garantir durabilidade dos dados.