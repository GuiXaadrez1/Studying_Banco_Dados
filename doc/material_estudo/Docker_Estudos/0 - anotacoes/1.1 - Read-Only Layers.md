# Introdução

A arquitetura de containers no Docker é baseada em camadas que tornam o processo de construção, reutilização e distribuição de imagens extremamente eficiente. Entre essas camadas, a camada Read-Only (somente leitura) é fundamental para entender como os containers se comportam e como seus dados são armazenados ou descartados.

Este arquivo tem como objetivo dissecar tecnicamente o funcionamento da camada Read-Only, seus impactos no ciclo de vida de containers e sua relação com a persistência de dados.

##  🧱 Conceito de Camadas no Docker

Docker utiliza um sistema de arquivos empilhado (Union File System, ou UFS), onde as imagens são compostas por várias camadas sobrepostas. Essas camadas são criadas durante a construção da imagem por instruções no Dockerfile como FROM, RUN, COPY e ADD.

Essas camadas têm duas propriedades principais:

- Imutabilidade: cada camada é somente leitura (read-only).

- Cacheável: camadas anteriores são reutilizadas quando não são alteradas, o que melhora a performance de builds.

A camada final da imagem — composta por todas essas instruções — é a base para a criação do container.

## 📂 O Que é a Camada Read-Only

A camada Read-Only é a parte da imagem Docker que é:

- Imutável (não pode ser modificada após a build).

- Compartilhada entre múltiplos containers baseados na mesma imagem.

- O local onde estão os binários, bibliotecas, scripts e arquivos estáticos da imagem base.

Quando um container é iniciado a partir de uma imagem, essa camada serve como o "sistema de arquivos raiz" inicial.

Exemplo:

```bash
docker run -it ubuntu bash
```

Neste comando, o Docker cria um container com base na imagem ubuntu. Essa imagem já tem diversas camadas empilhadas (sistema base, pacotes, etc.), todas marcadas como read-only

## 🧊 Por Que a Camada é Somente Leitura?

A camada é somente leitura por motivos de:

- Segurança: impede modificações acidentais ou maliciosas na base da imagem.

- Reprodutibilidade: garante que qualquer container criado com a mesma imagem se comporte de forma idêntica.

- Eficiência: reduz redundância no disco, pois várias instâncias de containers podem compartilhar as mesmas camadas.

## 🖋 Como o Docker Escreve Dados, então?

Para permitir alterações durante a execução de containers, o Docker sobrepõe uma camada de escrita (Writable Layer), também chamada de container layer. Essa camada é volátil e descartada quando o container é destruído, salvo o uso de volumes.

### 📌 Esquema de camadas em tempo de execução:

```pgsql
Writable Layer  <- container escreve aqui
Read-Only Layer <- conteúdo da imagem base
```

## ⚙️ Operações que Afetam a Camada de Escrita

Durante a execução, quando você:

- Cria/modifica um arquivo: ele é armazenado na Writable Layer.

- Lê um arquivo: o Docker verifica primeiro na camada de escrita; se não existir, busca na camada Read-Only.

- Remove um arquivo da imagem: o Docker não deleta da Read-Only, apenas marca como "oculto" na camada de escrita.

## Exemplo Prático:

```bash
docker run -it ubuntu bash
touch /novo-arquivo.txt
```

ubuntu vem de camadas Read-Only.

novo-arquivo.txt é criado na camada de escrita.

Ao sair e remover o container, esse arquivo desaparece (volátil).

Para manter persistência, são usados volumes, que ficam fora do sistema de camadas (próxima anotação 1.2).

## 🔍 Comando para Inspecionar Camadas

Você pode ver as camadas de uma imagem com:

```bash
docker history <nome-da-imagem>
```

Exemplo:

```bash
docker history ubuntu
```

Para examinar o sistema de arquivos de um container:

```bash
docker diff <nome-ou-id-do-container>
```

Este comando mostra os arquivos modificados/adicionados/removidos em relação à camada Read-Only da imagem.

## 🧠 Considerações Técnicas

A camada Read-Only não consome mais espaço no disco mesmo com múltiplos containers, graças à deduplicação.

Essa camada também pode ser reutilizada por outras imagens que tenham a mesma base (FROM ubuntu, por exemplo).

Camadas Read-Only são armazenadas em /var/lib/docker/overlay2 ou outro sistema conforme o Storage Driver usado.

## 🧭 Quando é Relevante Saber Isso?

Ao construir imagens Docker: evita duplicação desnecessária.

Ao depurar containers: sabe-se onde estão os dados voláteis vs. os permanentes.

Ao configurar persistência com volumes ou docker commit: é fundamental entender onde os dados realmente estão sendo armazenados.

## ✅ Conclusão

A camada Read-Only é a fundação técnica das imagens Docker. Compreender seu papel é essencial para construir, gerenciar e escalar aplicações em containers de forma eficiente. Sua imutabilidade e compartilhamento são pilares da performance e confiabilidade do Docker, mas exigem a compreensão da Writable Layer e dos mecanismos de persistência para uso produtivo em ambientes reais.

