# IntroduÃ§Ã£o

A arquitetura de containers no Docker Ã© baseada em camadas que tornam o processo de construÃ§Ã£o, reutilizaÃ§Ã£o e distribuiÃ§Ã£o de imagens extremamente eficiente. Entre essas camadas, a camada Read-Only (somente leitura) Ã© fundamental para entender como os containers se comportam e como seus dados sÃ£o armazenados ou descartados.

Este arquivo tem como objetivo dissecar tecnicamente o funcionamento da camada Read-Only, seus impactos no ciclo de vida de containers e sua relaÃ§Ã£o com a persistÃªncia de dados.

##  ğŸ§± Conceito de Camadas no Docker

Docker utiliza um sistema de arquivos empilhado (Union File System, ou UFS), onde as imagens sÃ£o compostas por vÃ¡rias camadas sobrepostas. Essas camadas sÃ£o criadas durante a construÃ§Ã£o da imagem por instruÃ§Ãµes no Dockerfile como FROM, RUN, COPY e ADD.

Essas camadas tÃªm duas propriedades principais:

- Imutabilidade: cada camada Ã© somente leitura (read-only).

- CacheÃ¡vel: camadas anteriores sÃ£o reutilizadas quando nÃ£o sÃ£o alteradas, o que melhora a performance de builds.

A camada final da imagem â€” composta por todas essas instruÃ§Ãµes â€” Ã© a base para a criaÃ§Ã£o do container.

## ğŸ“‚ O Que Ã© a Camada Read-Only

A camada Read-Only Ã© a parte da imagem Docker que Ã©:

- ImutÃ¡vel (nÃ£o pode ser modificada apÃ³s a build).

- Compartilhada entre mÃºltiplos containers baseados na mesma imagem.

- O local onde estÃ£o os binÃ¡rios, bibliotecas, scripts e arquivos estÃ¡ticos da imagem base.

Quando um container Ã© iniciado a partir de uma imagem, essa camada serve como o "sistema de arquivos raiz" inicial.

Exemplo:

```bash
docker run -it ubuntu bash
```

Neste comando, o Docker cria um container com base na imagem ubuntu. Essa imagem jÃ¡ tem diversas camadas empilhadas (sistema base, pacotes, etc.), todas marcadas como read-only

## ğŸ§Š Por Que a Camada Ã© Somente Leitura?

A camada Ã© somente leitura por motivos de:

- SeguranÃ§a: impede modificaÃ§Ãµes acidentais ou maliciosas na base da imagem.

- Reprodutibilidade: garante que qualquer container criado com a mesma imagem se comporte de forma idÃªntica.

- EficiÃªncia: reduz redundÃ¢ncia no disco, pois vÃ¡rias instÃ¢ncias de containers podem compartilhar as mesmas camadas.

## ğŸ–‹ Como o Docker Escreve Dados, entÃ£o?

Para permitir alteraÃ§Ãµes durante a execuÃ§Ã£o de containers, o Docker sobrepÃµe uma camada de escrita (Writable Layer), tambÃ©m chamada de container layer. Essa camada Ã© volÃ¡til e descartada quando o container Ã© destruÃ­do, salvo o uso de volumes.

### ğŸ“Œ Esquema de camadas em tempo de execuÃ§Ã£o:

```pgsql
Writable Layer  <- container escreve aqui
Read-Only Layer <- conteÃºdo da imagem base
```

## âš™ï¸ OperaÃ§Ãµes que Afetam a Camada de Escrita

Durante a execuÃ§Ã£o, quando vocÃª:

- Cria/modifica um arquivo: ele Ã© armazenado na Writable Layer.

- LÃª um arquivo: o Docker verifica primeiro na camada de escrita; se nÃ£o existir, busca na camada Read-Only.

- Remove um arquivo da imagem: o Docker nÃ£o deleta da Read-Only, apenas marca como "oculto" na camada de escrita.

## Exemplo PrÃ¡tico:

```bash
docker run -it ubuntu bash
touch /novo-arquivo.txt
```

ubuntu vem de camadas Read-Only.

novo-arquivo.txt Ã© criado na camada de escrita.

Ao sair e remover o container, esse arquivo desaparece (volÃ¡til).

Para manter persistÃªncia, sÃ£o usados volumes, que ficam fora do sistema de camadas (prÃ³xima anotaÃ§Ã£o 1.2).

## ğŸ” Comando para Inspecionar Camadas

VocÃª pode ver as camadas de uma imagem com:

```bash
docker history <nome-da-imagem>
```

Exemplo:

```bash
docker history ubuntu
```

Para examinar o sistema de arquivos de um container:

```bash
docker diff <nome-ou-id-do-container>
```

Este comando mostra os arquivos modificados/adicionados/removidos em relaÃ§Ã£o Ã  camada Read-Only da imagem.

## ğŸ§  ConsideraÃ§Ãµes TÃ©cnicas

A camada Read-Only nÃ£o consome mais espaÃ§o no disco mesmo com mÃºltiplos containers, graÃ§as Ã  deduplicaÃ§Ã£o.

Essa camada tambÃ©m pode ser reutilizada por outras imagens que tenham a mesma base (FROM ubuntu, por exemplo).

Camadas Read-Only sÃ£o armazenadas em /var/lib/docker/overlay2 ou outro sistema conforme o Storage Driver usado.

## ğŸ§­ Quando Ã© Relevante Saber Isso?

Ao construir imagens Docker: evita duplicaÃ§Ã£o desnecessÃ¡ria.

Ao depurar containers: sabe-se onde estÃ£o os dados volÃ¡teis vs. os permanentes.

Ao configurar persistÃªncia com volumes ou docker commit: Ã© fundamental entender onde os dados realmente estÃ£o sendo armazenados.

## âœ… ConclusÃ£o

A camada Read-Only Ã© a fundaÃ§Ã£o tÃ©cnica das imagens Docker. Compreender seu papel Ã© essencial para construir, gerenciar e escalar aplicaÃ§Ãµes em containers de forma eficiente. Sua imutabilidade e compartilhamento sÃ£o pilares da performance e confiabilidade do Docker, mas exigem a compreensÃ£o da Writable Layer e dos mecanismos de persistÃªncia para uso produtivo em ambientes reais.

