# DCL (Data Control Language) no PostgreSQL

O DCL (Data Control Language) é um subconjunto da linguagem SQL voltado para o controle de acesso e segurança dentro do banco de dados.

Enquanto o DDL (Data Definition Language) define a estrutura do banco (tabelas, índices, etc.), o DML manipula os dados, e o TCL gerencia transações, o DCL garante que apenas os usuários adequados possam acessar, modificar ou administrar recursos específicos.

Em bancos de dados corporativos, a segurança e o controle de acesso são fundamentais. O PostgreSQL implementa isso por meio de roles (papéis), permissões e comandos de concessão/revogação de privilégios.

## Principais comandos do DCL

O DCL no PostgreSQL é composto principalmente por dois comandos:

- GRANT → Concede permissões a usuários ou roles.

- REVOKE → Remove permissões previamente concedidas.

## Estrutura de permissões no PostgreSQL

Antes de explorar os comandos, é importante entender como o PostgreSQL organiza a segurança:

- Roles → são "usuários" ou "grupos de usuários".

- Objetos do banco → tabelas, views, sequências, esquemas, bancos, funções, entre outros.

- Privilégios → tipos de ações que podem ser executadas em cada objeto (SELECT, INSERT, UPDATE, DELETE, USAGE, EXECUTE, etc.).

Exemplo de privilégios por objeto:

- Tabelas/Views → SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER.

- Sequências → SELECT, USAGE, UPDATE.

- Funções → EXECUTE.

- Schemas → USAGE, CREATE.

- Bancos de dados → CONNECT, CREATE, TEMP.

## O comando GRANT

O GRANT é usado para conceder privilégios a roles (usuários ou grupos).

Sintaxe geral:

```sql
GRANT { privilégio [, ...] | ALL [PRIVILEGES] }
ON objeto [, ...]
TO role [, ...]
[WITH GRANT OPTION];
```

- privilégio → a permissão que será concedida.

- objeto → tabela, view, schema, banco, função, etc.

- role → usuário ou grupo que receberá a permissão.

- WITH GRANT OPTION → permite que o usuário beneficiado conceda o mesmo privilégio a outros.

## Exemplos:

- Permitir leitura em uma tabela

```sql
GRANT SELECT ON tabela_clientes TO usuario_app;
```

### Permitir inserir e atualizar dados

```sql
GRANT INSERT, UPDATE ON tabela_clientes TO usuario_app;
```

### Conceder todos os privilégios em uma tabela

```sql
GRANT ALL PRIVILEGES ON tabela_clientes TO usuario_admin;
```

### Permitir que um usuário repasse privilégios

```sql
GRANT SELECT ON tabela_clientes TO usuario_analista WITH GRANT OPTION;
```

### O comando REVOKE

O REVOKE é usado para remover privilégios previamente concedidos.

Sintaxe geral:

```sql
REVOKE [GRANT OPTION FOR]
{ privilégio [, ...] | ALL [PRIVILEGES] }
ON objeto [, ...]
FROM role [, ...]
[CASCADE | RESTRICT];
```

- GRANT OPTION FOR → remove o direito de repassar privilégios.

- CASCADE → revoga automaticamente todos os privilégios concedidos a partir do usuário que os possuía.

- RESTRICT → impede a revogação se ela impactar outros usuários.

## Exemplos:

### Remover privilégio de leitura

```sql
REVOKE SELECT ON tabela_clientes FROM usuario_app;
```

### Remover todos os privilégios de uma tabela

```sql
REVOKE ALL PRIVILEGES ON tabela_clientes FROM usuario_admin;
```

### Remover o direito de repassar privilégios sem retirar o privilégio em si

```sql
REVOKE GRANT OPTION FOR SELECT ON tabela_clientes FROM usuario_analista;
```

## Diferença entre GRANT e REVOKE

GRANT → adiciona permissões.

REVOKE → remove permissões.

Ou seja, GRANT abre portas e REVOKE fecha portas.

## Boas práticas no uso de DCL

- Princípio do menor privilégio → conceder apenas o necessário para cada role.

- Separar roles administrativas e operacionais → não misturar permissões de administração com permissões de aplicação.

- Usar roles intermediárias → conceder permissões a grupos em vez de usuários individuais, facilitando a gestão.

- Evitar ALL PRIVILEGES em produção → prefira conceder privilégios específicos.

- Auditar permissões periodicamente → verificar se usuários ainda precisam dos privilégios concedidos.

## Exemplo prático completo

Suponha que temos um banco de dados chamado empresa, com uma tabela funcionarios.

```sql

-- Passo 1 – Criar roles

-- Usuário apenas para consultas
CREATE ROLE analista LOGIN PASSWORD '123';

-- Usuário com permissões de escrita
CREATE ROLE operador LOGIN PASSWORD '456';

-- Usuário administrador
CREATE ROLE gerente LOGIN PASSWORD '789';

-- Passo 2 – Conceder privilégios

-- Conceder SELECT ao analista
GRANT SELECT ON funcionarios TO analista;

-- Conceder INSERT e UPDATE ao operador
GRANT INSERT, UPDATE ON funcionarios TO operador;

-- Conceder todos os privilégios ao gerente
GRANT ALL PRIVILEGES ON funcionarios TO gerente;

-- Passo 3 – Revogar privilégios

-- Revogar a permissão de UPDATE do operador
REVOKE UPDATE ON funcionarios FROM operador;

-- Revogar todos os privilégios do gerente (hipotético)
REVOKE ALL PRIVILEGES ON funcionarios FROM gerente;
```

## ✅ Resumo:

O DCL no PostgreSQL é o mecanismo de segurança e controle de acesso do banco de dados.

Com os comandos GRANT e REVOKE, é possível conceder ou retirar privilégios sobre tabelas, views, schemas, funções e até bancos de dados inteiros.