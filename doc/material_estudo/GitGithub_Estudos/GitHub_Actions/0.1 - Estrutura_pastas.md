# Introdução 
Este documento visa explicar como funciona a estrtura de diretórios(pasta) para podermos 
fazer o nosso Github Action

## 📂 Estrutura correta da pasta .github

Regra principal: 
    A pasta .github DEVE estar na raiz do repositório se você quer que o GitHub Actions reconheça seus workflows automaticamente.

Exemplo: 

```bash
meu-projeto/
 ├── .github/
 │    └── workflows/
 │         ├── ci.yml
 │         ├── deploy.yml
 ├── src/
 ├── package.json
 └── README.md
```

### Por que?
O GitHub procura automaticamente os arquivos YAML dentro de:

```bash
<raiz do repositório>/.github/workflows/
```

Se você colocar em uma subpasta como:

```bash
meu-projeto/src/.github/workflows/
```

ou

```bash
meu-projeto/.github/ci/workflows/
```

NÃO FUNCIONA!

O GitHub ignora — ele não “procura” em subpastas, ele espera exatamente: .github/workflows/.

## O que pode estar dentro da pasta .github

A pasta .github pode conter:

| Pasta/Arquivo                      | Função                                        |
| ---------------------------------- | --------------------------------------------- |
| `.github/workflows/`               | Contém **workflows YAML** do Actions          |
| `.github/ISSUE_TEMPLATE/`          | Templates de **issues**                       |
| `.github/PULL_REQUEST_TEMPLATE.md` | Template de **pull request**                  |
| `.github/FUNDING.yml`              | Configura botão de doação                     |
| `.github/CODEOWNERS`               | Define **quem revisa** quais partes do código |

## Estrutura detalhada de um workflow

📄 Arquivo: .github/workflows/ci.yml

```yaml
name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Instala dependências
        run: npm install

      - name: Roda testes
        run: npm test

  deploy:
    runs-on: ubuntu-latest
    needs: build # Só roda se 'build' tiver sucesso
    steps:
      - name: Deploy fictício
        run: echo "Deploy OK!"

```

Vamos analisar bloco por bloco, com exemplos didáticos e explicação linha por linha.

### name

```yaml
name: CI Pipeline
```

É opcional, mas recomendado.

Define como o workflow aparece na aba Actions do repositório.

### on

```yaml
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

```

push ➜ Roda quando alguém faz push.

pull_request ➜ Roda em PRs abertos para main.

workflow_dispatch ➜ Permite rodar manual pelo botão Run workflow.

schedule ➜ Executa automaticamente em horários fixos (cron).

### jobs

Um workflow pode ter um ou vários jobs.
Cada job é independente (a menos que use needs:).

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Instala dependências
        run: npm install

      - name: Roda testes
        run: npm test

  deploy:
    runs-on: ubuntu-latest
    needs: build # Só roda se 'build' tiver sucesso
    steps:
      - name: Deploy fictício
        run: echo "Deploy OK!"
```

**Dentro de jobs:**

| Campo      | O que faz                                                 |
| ---------- | --------------------------------------------------------- |
| `runs-on:` | Qual máquina virtual vai executar (Ubuntu, Windows, Mac). |
| `steps:`   | Lista de comandos ou ações que rodam em sequência.        |
| `needs:`   | Define **dependência entre jobs**.                        |
| `env:`     | Define variáveis de ambiente globais para o job.          |

**Dentro de steps:**

Cada step é um bloco de execução:

- Executa um comando direto (run:)

- Ou usa uma ação pronta (uses:)

- Pode ter with: para passar parâmetros.

```yaml
steps:
  - name: Checkout
    uses: actions/checkout@v4

  - name: Instala dependências
    run: npm install

  - name: Build
    run: npm run build

  - name: Deploy para S3
    uses: jakejarvis/s3-sync-action@master
    with:
      args: --acl public-read --delete
    env:
      AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_REGION: 'us-east-1'

```

## Variáveis, Secrets e Contextos

- ✅ env: — Variáveis de ambiente globais ou locais (por job, por step).
- ✅ secrets — São valores seguros, como tokens de API. Você guarda no GitHub → Settings > Secrets.
- ✅ Contextos — ${{ secrets.MINHA_SECRET }} ou ${{ github.ref }}.

Exemplo:

```yaml
env:
  NODE_ENV: production

# Usando secret:
AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}

```

## Onde o GitHub Actions executa

Cada job roda numa máquina virtual descartável.
Você não precisa configurar servidor de build → o GitHub hospeda pra você.

## Checklist Final

✔️ .github/workflows DEVE estar na raiz do projeto.
✔️ Múltiplos YAMLs = múltiplos workflows.
✔️ on: define quando dispara.
✔️ jobs: define o que fazer.
✔️ Cada job = VM separada.
✔️ steps = ações + comandos shell.